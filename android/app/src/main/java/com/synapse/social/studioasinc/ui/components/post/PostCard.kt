package com.synapse.social.studioasinc.ui.components.post

import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.padding
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.synapse.social.studioasinc.model.Post
import com.synapse.social.studioasinc.home.User

// Helper state class for PostCard (can be expanded)
data class PostCardState(
    val post: Post,
    val user: User, // Add User here as it's needed for Header
    val isLiked: Boolean,
    val likeCount: Int,
    val commentCount: Int,
    val isBookmarked: Boolean,
    val mediaUrls: List<String> = emptyList(), // Extract from post
    val isVideo: Boolean = false,
    val pollQuestion: String? = null,
    val pollOptions: List<PollOption>? = null
)

@Composable
fun PostCard(
    state: PostCardState,
    onLikeClick: () -> Unit,
    onCommentClick: () -> Unit,
    onShareClick: () -> Unit,
    onBookmarkClick: () -> Unit,
    onUserClick: () -> Unit,
    onPostClick: () -> Unit,
    onMediaClick: (Int) -> Unit,
    onOptionsClick: () -> Unit,
    onPollVote: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier
            .fillMaxWidth()
            .padding(vertical = 4.dp, horizontal = 0.dp) // Edge-to-edge feel usually implies no horizontal padding for card itself in feed, but let's stick to design
            .clickable(onClick = onPostClick),
        colors = CardDefaults.cardColors(
            containerColor = MaterialTheme.colorScheme.surface
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp),
        shape = MaterialTheme.shapes.small // Or RectangleShape for full bleed
    ) {
        Column {
            PostHeader(
                user = state.user,
                timestamp = state.post.publishDate ?: "",
                onUserClick = onUserClick,
                onOptionsClick = onOptionsClick
            )

            PostContent(
                text = state.post.postText,
                mediaUrls = state.mediaUrls,
                isVideo = state.isVideo,
                pollQuestion = state.pollQuestion,
                pollOptions = state.pollOptions,
                onMediaClick = onMediaClick,
                onPollVote = onPollVote
            )

            PostInteractionBar(
                isLiked = state.isLiked,
                likeCount = state.likeCount,
                commentCount = state.commentCount,
                isBookmarked = state.isBookmarked,
                onLikeClick = onLikeClick,
                onCommentClick = onCommentClick,
                onShareClick = onShareClick,
                onBookmarkClick = onBookmarkClick
            )

            // Comment Preview Section (Task 2.6) - simplified integration
            if (state.commentCount > 0) {
                 CommentPreview(
                    commentCount = state.commentCount,
                    topCommentAuthor = "User1", // Placeholder
                    topCommentText = "Nice post!", // Placeholder
                    onViewAllClick = onCommentClick
                )
            }
        }
    }
}
