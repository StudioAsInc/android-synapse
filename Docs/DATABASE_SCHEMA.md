# Database Schema for Supabase Migration

This document outlines the inferred database schema based on the existing application's data access patterns. This schema will serve as a guide for creating tables and columns in Supabase.

## Tables

### 1. `users`
- **Purpose**: Stores user profile information.
- **Columns**:
    - `id`: UUID (Primary Key, auto-generated by Supabase Auth)
    - `uid`: String (Unique User ID, likely from Firebase previously, now linked to Supabase `id`)
    - `banned`: Boolean (or String 'true'/'false')
    - `nickname`: String
    - `username`: String (Unique)
    - `status`: String
    - `avatar`: String (URL to avatar image)
    - `gender`: String
    - `verify`: Boolean (or String 'true'/'false')
    - `account_type`: String (e.g., 'user', 'admin', 'support')
    - `created_at`: Timestamp (auto-generated)

### 2. `following`
- **Purpose**: Stores relationships between users (who follows whom).
- **Columns**:
    - `id`: UUID (Primary Key, auto-generated)
    - `follower_uid`: String (Foreign Key to `users.uid`)
    - `followed_uid`: String (Foreign Key to `users.uid`)
    - `created_at`: Timestamp (auto-generated)

### 3. `chat_messages`
- **Purpose**: Stores chat messages.
- **Columns**:
    - `id`: UUID (Primary Key, auto-generated)
    - `key`: String (Unique identifier for the message, possibly from Firebase push key)
    - `sender_uid`: String (Foreign Key to `users.uid`)
    - `message_content`: Text
    - `timestamp`: Timestamp (Unix epoch or ISO 8601)
    - `replied_message_id`: String (Optional, references `chat_messages.key` for replies)
    - `created_at`: Timestamp (auto-generated)

### 4. `posts-comments`
- **Purpose**: Stores comments on posts.
- **Columns**:
    - `id`: UUID (Primary Key, auto-generated)
    - `key`: String (Unique identifier for the comment)
    - `postKey`: String (Identifier for the post the comment belongs to)
    - `uid`: String (Foreign Key to `users.uid`, the commenter's ID)
    - `comment`: Text
    - `timestamp`: Timestamp (Unix epoch or ISO 8601)
    - `created_at`: Timestamp (auto-generated)

## Relationships

- `following.follower_uid` -> `users.uid`
- `following.followed_uid` -> `users.uid`
- `chat_messages.sender_uid` -> `users.uid`
- `chat_messages.replied_message_id` -> `chat_messages.key` (Self-referencing)
- `posts-comments.uid` -> `users.uid`

## Migration Notes

- **Primary Keys**: Supabase tables typically use a `UUID` as the primary key. Existing `key` fields from Firebase might need to be mapped or retained as unique identifiers.
- **Timestamps**: Ensure `timestamp` fields are correctly converted to Supabase's `timestamp with time zone` or `timestamp without time zone` types.
- **Foreign Keys**: Establish foreign key constraints in Supabase to maintain data integrity.
- **Realtime**: For `chat_messages`, Supabase Realtime will be used for live updates.
- **Data Types**: Carefully map existing data types to appropriate PostgreSQL types.